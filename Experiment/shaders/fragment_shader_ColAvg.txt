#version 300 es
precision highp float;
precision highp int;
out vec4 outColor; // name of the output variable

in vec2 interpolatedTexCoord;

uniform sampler2D RowAvg; // min_filter="NEAREST" mag_filter="NEAREST"

uniform int width;
uniform int height;
uniform int samples; // description="Number of samples" defaultval="256"
uniform bool debug; // description="Enable debugging of sampling locations" defaultval="false"

uniform int inputImageWidth;
uniform int inputImageHeight;


#define PI 3.1415926535897932384626433832795


// pixel to textureCoord 
float p2t(in float p, in int noOfPixels) {
   return (p + 0.5) / float(noOfPixels);
}

// round to nearest integer
int round2Integer(in float val) {
  return int(val + 0.5);
}


// convert texture coordinates to pixels
float t2p(in float t, in int noOfPixels) {
  return t * float(noOfPixels) - 0.5;
}

void main() {
  
  // col avg
  float sum = 0.0;
  int x = round2Integer(t2p(interpolatedTexCoord.x, inputImageWidth));
  for(int y = 0; y < inputImageHeight; y++) {
    float gray = texelFetch(RowAvg, ivec2(x, y), 0).r;
    sum += gray;
  }
  sum /= float(inputImageHeight);
  outColor = vec4(sum, sum, sum, 1.0);
  //outColor = vec4(1.0, 0.0, 0.0, 1.0);
}
